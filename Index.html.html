<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planetary Discovery App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
            background-color: #000;
        }
        canvas {
            display: block;
        }
        .app-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: #000;
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center justify-center">
    <!-- Main application layout -->
    <div class="app-container">
        <!-- Main 3D container -->
        <div id="simulation-container" class="relative w-full h-full flex items-center justify-center">
            <!-- The canvas for the 3D scene will be added by Three.js -->
        </div>

        <!-- Control and info panel -->
        <div class="absolute bottom-4 left-1/2 -translate-x-1/2 w-11/12 md:w-2/3 lg:w-1/2 p-6 bg-gray-800 bg-opacity-80 backdrop-blur-sm rounded-xl shadow-lg flex flex-col space-y-4 border border-gray-700">
            <h1 class="text-3xl font-extrabold text-center text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500">
                PLANETARY DISCOVERY
            </h1>
            <p class="text-gray-400 text-center text-sm md:text-base">
                Drag the planet to rotate it. Click the button below to generate a new description from the cosmic archives.
            </p>
            
            <!-- LLM-powered button -->
            <button id="generate-btn" class="w-full px-6 py-3 bg-indigo-600 text-white font-semibold rounded-full shadow-lg hover:bg-indigo-700 transition-all duration-300 transform hover:scale-105 active:scale-95 flex items-center justify-center space-x-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 animate-pulse" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15v-4H8l4-8v4h3l-4 8z"/>
                </svg>
                <span>Discover This World</span>
            </button>

            <!-- Description display area -->
            <div id="description-box" class="mt-4 p-4 text-sm bg-gray-900 rounded-lg text-gray-300 h-24 overflow-y-auto transition-all duration-300 border border-gray-700">
                <p id="description-text" class="leading-relaxed">Click the button to generate a fascinating description of this world.</p>
            </div>
        </div>
    </div>
    
    <!-- Three.js library from a CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // Use a self-executing anonymous function to encapsulate the code
        (function() {
            // --- Global Variables ---
            const container = document.getElementById('simulation-container');
            const generateBtn = document.getElementById('generate-btn');
            const descriptionText = document.getElementById('description-text');
            const apiKey = ""; // API key is provided by the canvas environment

            let scene, camera, renderer;
            let planet, star;

            // --- Scene Setup ---
            function init() {
                // Create a new scene
                scene = new THREE.Scene();
                
                // Create a perspective camera
                camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                camera.position.z = 5;

                // Create a WebGL renderer
                renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                renderer.setPixelRatio(window.devicePixelRatio);
                renderer.setSize(window.innerWidth, window.innerHeight);
                container.appendChild(renderer.domElement);

                // Add a faint ambient light to the scene
                const ambientLight = new THREE.AmbientLight(0x404040, 2);
                scene.add(ambientLight);

                // --- Object Creation ---
                // Create the planet geometry and material
                const planetGeometry = new THREE.SphereGeometry(1, 64, 64);
                const planetMaterial = new THREE.MeshStandardMaterial({
                    color: 0x4a90e2,
                    roughness: 0.8,
                    metalness: 0.2
                });
                planet = new THREE.Mesh(planetGeometry, planetMaterial);
                scene.add(planet);

                // Create a point light to act as the "star"
                star = new THREE.PointLight(0xffffff, 30, 100);
                star.position.set(5, 5, 5);
                scene.add(star);

                // --- Event Listeners and Interaction ---
                let isDragging = false;
                let previousMousePosition = { x: 0, y: 0 };

                // Mouse controls for rotation
                document.addEventListener('mousedown', (e) => {
                    isDragging = true;
                    previousMousePosition = { x: e.clientX, y: e.clientY };
                });
                document.addEventListener('mouseup', () => {
                    isDragging = false;
                });
                document.addEventListener('mousemove', (e) => {
                    if (!isDragging) return;
                    const deltaX = e.clientX - previousMousePosition.x;
                    const deltaY = e.clientY - previousMousePosition.y;

                    const rotationSpeed = 0.005;
                    planet.rotation.y += deltaX * rotationSpeed;
                    planet.rotation.x += deltaY * rotationSpeed;

                    previousMousePosition = { x: e.clientX, y: e.clientY };
                });
                
                // Handle window resizing
                window.addEventListener('resize', onWindowResize, false);

                // Handle button click for API call
                generateBtn.addEventListener('click', getPlanetInfo);
            }

            function onWindowResize() {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            }

            // --- LLM API Call Function ---
            async function getPlanetInfo() {
                const prompt = "Generate a short, creative description (100-150 words) of a fictional planet. Include its name, a brief overview of its environment (e.g., weather, flora/fauna), and a unique characteristic. The tone should be like a sci-fi travel guide entry.";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                // Show loading state
                generateBtn.disabled = true;
                generateBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 animate-spin" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93v-2.02c-3.32-.4-6-3.23-6-6.91s2.68-6.51 6-6.91V4.07c-4.47.45-8 4.31-8 9.93s3.53 9.48 8 9.93z"/></svg><span>Generating...</span>';
                descriptionText.textContent = 'Connecting with the intergalactic archives...';

                try {
                    const payload = {
                        contents: [{ parts: [{ text: prompt }] }],
                        tools: [{ "google_search": {} }],
                        systemInstruction: { parts: [{ text: "You are a creative writer and planetary expert." }] }
                    };

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(`API error: ${errorData.error.message}`);
                    }

                    const result = await response.json();
                    const text = result.candidates?.[0]?.content?.parts?.[0]?.text;

                    if (text) {
                        descriptionText.textContent = text;
                    } else {
                        descriptionText.textContent = 'Error: Could not retrieve a valid description.';
                    }
                } catch (error) {
                    console.error("Failed to fetch planet info:", error);
                    descriptionText.textContent = `Error: ${error.message}`;
                } finally {
                    // Reset button state
                    generateBtn.disabled = false;
                    generateBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15v-4H8l4-8v4h3l-4 8z"/></svg><span>Discover This World</span>';
                }
            }

            // --- Animation Loop ---
            function animate() {
                requestAnimationFrame(animate);
                planet.rotation.y += 0.002;
                renderer.render(scene, camera);
            }

            // Start the application on window load
            window.onload = function() {
                init();
                animate();
            };

        })();
    </script>
</body>
</html>
